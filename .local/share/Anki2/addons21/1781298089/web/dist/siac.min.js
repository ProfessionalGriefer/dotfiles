(function(t,e){for(var a in e)t[a]=e[a]})(window,function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,a){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:a})},t.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&'object'==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,'default',{enumerable:!0,value:e}),2&i&&'string'!=typeof e)for(var n in e)t.d(a,n,function(t){return e[t]}.bind(null,n));return a},t.n=function(e){var i=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(i,'a',i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=1)}([function(e,t,i){'use strict';var a=Math.max,n=Math.abs,s=Math.min;i.r(t),i.d(t,'Highlighting',function(){return d});const d={colorSelected:{id:1,color:'red'},current:[],highlight:function(){let e=window.getSelection(),t=e.getRangeAt(0);$('#text-layer > span').css('height','auto');let i=t.getClientRects();if(100<i.length)return void readerNotification('Selection too long to highlight.');let a=this._fuseOverlappingClientRects(i),n=byId('text-layer').getBoundingClientRect(),s=byId('text-layer').offsetLeft,d=pdf.page+' -1 '+this.colorSelected.id+' ';a.forEach((e)=>{let t=e.x-n.x,i=e.y-n.y,a=pdf.displayedViewPort.convertToPdfPoint(t,i);d+=a[0]+' '+a[1]+' ',a=pdf.displayedViewPort.convertToPdfPoint(t+e.w,i+e.h),d+=a[0]+' '+a[1]+' '}),d+='# '+e.toString(),e.removeAllRanges(),pycmd('siac-hl-new '+d),$('#text-layer > span').css('height','100px')},createAreaHighlight:function(e,i,a,n){let s=this.colorSelected.id;if(!(1>s||2>a&&2>n)&&!(e+a>activeCanvas().offsetWidth)&&!(i+n>activeCanvas().offsetHeight)){6<=s&&(s+=3,e-=3,i-=3);let t=pdf.displayedViewPort.convertToPdfPoint(e,i),d=pdf.displayedViewPort.convertToPdfPoint(e+a,i+n),l=`siac-hl-new ${pdf.page} -1 ${s} ${t[0]} ${t[1]} ${d[0]} ${d[1]} # `;pycmd(l)}},insertText:function(e){let t=byId('text-layer').getBoundingClientRect(),i=byId('text-layer').offsetLeft,a=e.clientX-t.x,n=e.clientY-t.y;this._createHighlightDiv(a+i,n,100,20,this.colorSelected.id,'');let s=pdf.page+' -1 0 ',d=pdf.displayedViewPort.convertToPdfPoint(a,n);s+=d[0]+' '+d[1]+' ',d=pdf.displayedViewPort.convertToPdfPoint(a+100,n+20),s+=d[0]+' '+d[1]+' #',pycmd('siac-hl-new '+s)},displayFakeHighlight:function(){this._createHighlightDiv(0,0,50,50,1,-1)},displayHighlights:function(){this._removeAllHighlights();let e=activeCanvas();if(e){let t=byId('siac-pdf-overflow').scrollTop;this.current.forEach((i)=>{let a=i[0],d=i[1],l=i[2],o=i[3],r=i[4],t=i[5],c=i[6],p=pdf.displayedViewPort.convertToViewportRectangle([a,d,l,o]),g=s(p[0],p[2]);g+=e.offsetLeft;let f=s(p[1],p[3]),u=n(p[0]-p[2]),m=n(p[1]-p[3]);this._createHighlightDiv(g,f,u,m,r,t,c)}),byId('siac-pdf-overflow').scrollTop=t}},_removeAllHighlights:function(){for(let e=document.getElementsByClassName('siac-hl');e[0];)e[0].parentNode.removeChild(e[0])},_colorById:function(e){return 0===e?'white':1===e?'#e65100':2===e?'#558b2f':3===e?'#2196f3':4===e?'#ffee58':5===e?'#ab47bc':6===e||9===e?'#e65100':7===e||10===e?'#558b2f':8===e||11===e?'#2196f3':void 0},_fuseOverlappingClientRects:function(e){let t,i,d,l=!0,o=0,r=[];for(var c=0;c<e.length;c++)r.push({x:e[c].x,y:e[c].y,w:e[c].width,h:e[c].height});if(1===r.length)return r;for(;l;){l=!1;let e=[],c=0;for(var p=0;p<r.length;p++)if(!(l&&c===p)){if(t=r[p].x,i=r[p].y,d=r[p].w,o=r[p].h,!l)for(c=0;c<r.length;c++)if(c!==p&&(r[c].x===t&&r[c].y===i&&r[c].w===d&&r[c].h!==o?(o=a(r[c].h,o),l=!0):r[c].x===t&&r[c].y===i&&r[c].w!==d&&r[c].h===o?(d=a(r[c].w,d),l=!0):r[c].x===t&&r[c].y!==i&&r[c].w===d&&r[c].h===o?(i=s(i,r[c].y),l=!0):r[c].x!==t&&r[c].y===i&&r[c].w===d&&r[c].h===o?(t=s(t,r[c].x),l=!0):r[c].x!==t&&r[c].y===i&&r[c].w===d&&r[c].h!==o&&100>n(r[c].h-o)?(t=s(t,r[c].x),o=a(r[c].h,o),l=!0):r[c].x!==t&&r[c].y===i&&r[c].h===o?(r[c].x<t?(d=t+d-r[c].x,t=r[c].x):d=r[c].x+r[c].w-t,l=!0):r[c].x===t&&r[c].w===d?(o=a(r[c].h,o,a(i+o,r[c].y+r[c].h)-s(r[c].y,i)),i=s(r[c].y,i),l=!0):r[c].y>i&&r[c].y+r[c].h<i+o?(d=a(r[c].w,d,r[c].x+r[c].w-s(r[c].x,t),t+d-s(r[c].x,t)),t=s(r[c].x,t),l=!0):n(r[c].y-i)<o&&(d=a(r[c].w,d,r[c].x+r[c].w-s(r[c].x,t),t+d-s(r[c].x,t)),i=s(r[c].y,i),o=r[c].h+n(r[c].y-i),l=!0),l)){c<p&&e.splice(c,1);break}-1===e.indexOf({x:t,y:i,w:d,h:o})&&e.push({x:t,y:i,w:d,h:o})}if(l&&r.length===e.length)return console.log('something went terribly wrong'),r;r=Array.from(e)}return r},onColorBtn:function(e){this.colorSelected={id:+$(e).data('id'),color:$(e).data('color')},$('.siac-pdf-color-btn,.siac-pdf-ul-btn').removeClass('active'),$(e).addClass('active'),pycmd('siac-hl-clicked '+this.colorSelected.id+' '+this.colorSelected.color),0<this.colorSelected.id?readerNotification('CTRL + select to Highlight<br>CTRL + Shift + A to Area Highlight'):readerNotification('CTRL + click to insert text<br>CTRL + click again to remove')},onTextMouseUp:function(e,t){if(t.dataset.id&&(t.offsetWidth!=t.dataset.ow||t.clientHeight!=t.dataset.oh)){t.dataset.ow=t.offsetWidth,t.dataset.oh=t.clientHeight;let e=byId('text-layer').getBoundingClientRect(),i=t.offsetLeft-activeCanvas().offsetLeft,a=t.offsetTop,n=i+t.offsetWidth-6,s=a+t.clientHeight,d=pdf.displayedViewPort.convertToPdfPoint(i,a);i=d[0],a=d[1],d=pdf.displayedViewPort.convertToPdfPoint(n,s),n=d[0],s=d[1],pycmd(`siac-hl-text-update-coords ${t.dataset.id} ${i} ${a} ${n-2} ${s+2}`)}},onTextBlur:function(e){e.dataset.id&&pycmd(`siac-hl-text-update-text ${e.dataset.id} ${pdf.page} ${$(e).val()}`)},onTextKeyup:function(e){$(e).height(1),$(e).height($(e).prop('scrollHeight')+1),this.onTextMouseUp(null,e)},hlClick:function(e,t){!t.dataset.id||(e.ctrlKey||e.metaKey)&&(this.current=this.current.filter((e)=>e[5]!=t.dataset.id),pycmd('siac-hl-del '+t.dataset.id),$(t).remove())},_createHighlightDiv:function(e,i,a,n,s,t=-1,d=''){let l;return 0<s?(l=document.createElement('div'),l.className='siac-hl siac-hl-c',l.style.height=n+'px',l.style.width=a+'px',l.style.top=i+'px',l.style.left=e+'px',-1!==t&&(l.dataset.id=t),l.setAttribute('onclick','Highlighting.hlClick(event, this);'),6<=s&&9>s?l.style.borderBottom='3px solid '+this._colorById(s):9<=s?l.style.border='3px solid '+this._colorById(s):l.style.background=this._colorById(s)):(l=document.createElement('textarea'),l.className='siac-hl siac-text-hl',l.style.height=n+'px',l.style.width=a+'px',l.style.top=i+'px',l.style.left=e+'px',-1!==t&&(l.dataset.id=t),l.value=d,l.setAttribute('onclick','Highlighting.hlClick(event, this);'),l.style.background=this._colorById(s),l.setAttribute('onmouseup','Highlighting.onTextMouseUp(event, this);'),l.setAttribute('onblur','Highlighting.onTextBlur(this);'),l.setAttribute('onkeyup','Highlighting.onTextKeyup(this);')),byId('siac-pdf-overflow').append(l),l}}},function(e,t,i){e.exports=i(11)},function(e,t,i){var n=Math.max,s=Math.min;const{Highlighting:a}=i(0);window.siacState={selectedDecks:['-1'],timeout:null,isFrozen:!1,searchOnSelection:!0,searchOnTyping:!0,keepPositionAtRendering:!1},window.lastHadResults=!1,window.loadingTimer=null,window.calTimer=null,window.gridView=!1,window.tagHoverCB=null,window.tagHoverTimeout=750,window.searchMaskTimer=null,window.$fields=null,window.byId=function(e){return document.getElementById(e)},window.sendContent=function(e){if(e&&e.repeat||null!=pdf.instance||siacState.isFrozen)return;if(!$fields.text())return;let t='';showLoading('Typing'),$fields.each(function(e,i){t+=i.innerHTML+'\x1F'}),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+t)},window.searchCurrentField=function(){if(!(displayedNoteId||siacState.isFrozen)){let e=$('.field:focus').first();if(e.length){let i=e.text();i&&0!==i.trim().length&&(showLoading('Typing'),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+i))}}},window.sendSearchFieldContent=function(){showLoading('Searchbar'),html=byId('siac-browser-search-inp').value+'\x1F',pycmd('siac-r-srch-db '+siacState.selectedDecks.toString()+' ~ '+html)},window.searchFor=function(e){showLoading('Note Search'),e+='\x1F',pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+e)},window.searchForUserNote=function(e,t){t&&0!==t.value.length&&t.value.trim()&&(13==e.keyCode?('siac-sidebar-inp'!==t.id&&(t.parentElement.parentElement.style.display='none'),pycmd('siac-r-user-note-search-inp '+t.value)):t.id&&('Escape'===e.key||'Esc'===e.key)?t.parentElement.style.display='none':(clearTimeout(searchMaskTimer),searchMaskTimer=setTimeout(function(){pycmd('siac-r-user-note-search-inp '+t.value)},800)))},window.updateSelectedDecks=function(e){siacState.selectedDecks=[];let t='';e&&$(e).toggleClass('selected'),$('.deck-list-item.selected').each(function(){$(this).data('id')&&(siacState.selectedDecks.push($(this).data('id')),t+=' '+$(this).data('id'))}),pycmd('deckSelection'+t)},window.selectAllDecks=function(){$('.deck-list-item').addClass('selected'),updateSelectedDecks()},window.unselectAllDecks=function(){$('.deck-list-item').removeClass('selected'),updateSelectedDecks()},window.selectDeckWithId=function(e){$('.deck-list-item').removeClass('selected'),$('.deck-list-item').each(function(){$(this).data('id')==e&&$(this).addClass('selected')}),updateSelectedDecks()},window.selectDeckAndSubdecksWithId=function(e){$('.deck-list-item').removeClass('selected'),$(`.deck-list-item[data-id=${e}]`).addClass('selected'),$(`.deck-list-item[data-id=${e}] .deck-list-item`).addClass('selected'),updateSelectedDecks()},window.fixRetMarkWidth=function(e){e&&0<e.parentElement.getElementsByClassName('retMark').length&&0==e.parentElement.getElementsByClassName('retMark')[0].style.maxWidth.length&&(e.parentElement.getElementsByClassName('retMark')[0].style.maxWidth=e.offsetWidth+'px')},window.expandRankingLbl=function(e){fixRetMarkWidth(e),null===e.getElementsByClassName('rankingLblAddInfo')[0].offsetParent?(e.getElementsByClassName('rankingLblAddInfo')[0].style.display='inline',e.getElementsByClassName('editedStamp')[0].style.display='none',0!==e.parentElement.getElementsByClassName('siac-susp-lbl').length&&(e.parentElement.getElementsByClassName('siac-susp-lbl')[0].style.display='none')):(e.getElementsByClassName('rankingLblAddInfo')[0].style.display='none',e.getElementsByClassName('editedStamp')[0].style.display='inline',0!==e.parentElement.getElementsByClassName('siac-susp-lbl').length&&(e.parentElement.getElementsByClassName('siac-susp-lbl')[0].style.display='block'))},window.expandCard=function(e){pycmd('siac-note-stats '+e)},window.pinMouseLeave=function(e,t){t.toElement&&t.toElement.classList.contains('siac-inner-card')||(e.style.opacity='0')},window.pinMouseEnter=function(e){e.style.opacity='1'},window.cardMouseEnter=function(e,t,i='full'){'full'==i?byId('btnBar-'+t).style.opacity=1:byId('btnBarSmp-'+t).style.opacity=1},window.showLoading=function(e){loadingTimer=setTimeout(function(){byId('searchInfo').innerHTML=`<table><tr><td>Status</td><td><b>Searching</b></td></tr><tr><td>Source</td><td><i>${e}</i></td></tr></table>`},1e3)},window.totalOffset=function(e){var t=0,i=0;do t+=e.offsetTop||0,i+=e.offsetLeft||0,e=e.offsetParent;while(e);return{top:t,left:i}},window.cardMouseLeave=function(e,t,i='full'){setTimeout(function(){'full'==i?!$('#btnBar-'+t).is(':hover')&&!$(e).is(':hover')&&$('#btnBar-'+t).css('opacity','0'):!$('#btnBarSmp-'+t).is(':hover')&&!$(e).is(':hover')&&$('#btnBarSmp-'+t).css('opacity','0')},50)},window.tagMouseEnter=function(e){showTagInfoOnHover&&e&&e.parentElement&&!displayedNoteId&&(tagHoverCB=setTimeout(function(){e&&e.parentElement&&e.parentElement.querySelector(':hover')===e&&!byId('siac-tag-info-box-'+$(e).data('stamp'))&&pycmd('siac-tag-info '+$(e).data('stamp')+' '+$(e).data('name'))},tagHoverTimeout))},window.showTagInfo=function(e){let t=$(e).data('stamp');$(e).css('z-index','9999'),e&&$('#greyout').show();let a=totalOffset(e);a.top+=17;let n=document.getElementsByClassName('siac-tag-info-box');e.parentElement.id&&'tagContainer'===e.parentElement.id?a.top-=byId('tagContainer').scrollTop:1<n.length?0<=e.parentElement.parentElement.parentElement.className.indexOf('siac-tag-info-box-left')&&(a.top-=e.parentElement.parentElement.parentElement.scrollTop):null===byId('cal-info').offsetParent?a.top-=byId('searchResults').scrollTop:a.top-=byId('cal-info-notes').scrollTop;let s='siac-tag-info-box-'+t;a.left>window.outerWidth-a.left&&(a.left-=$('#siac-tag-info-box-'+t).outerWidth(),a.left+=$(e).outerWidth()+2);let d=0;for(var l=0;l<n.length;l++)+$(n[l]).css('z-index')>d&&(d=+$(n[l]).css('z-index'));if($('#siac-tag-info-box-'+t).css('top',a.top).css('left',a.left).css('z-index',d+1),a.top>window.outerHeight-a.top){byId(s).style.visibility='hidden',byId(s).style.display='block';let e=17;1<n.length&&(e=15),$('#'+s).css('top',a.top-$('#'+s).outerHeight()-e),byId(s).style.visibility='visible'}else byId(s).style.display='block'},window.tagMouseLeave=function(e){let t=$(e).data('stamp');if(!($('#siac-tag-info-box-'+t+':hover').length||$(`.tagLbl[data-stamp='${t}']:hover`).length)){let i=document.getElementsByClassName('siac-tag-info-box'),n=+$(e).css('z-index'),s=$('.siac-tag-info-box:hover').first();if(!s.length&&!$(`.tagLbl[data-stamp]:hover`).length)return $('.siac-tag-info-box').remove(),$('.tagLbl').css('z-index','4'),void $('#greyout').hide();if(s.length){let t=+s.css('z-index');if(e.id&&t>n)return;for(var a=0;a<i.length;a++)+$(i[a]).css('z-index')>t&&($(i[a]).remove(),a--)}$(`.tagLbl[data-stamp='${t}']`).first().css('z-index','4'),byId('siac-tag-info-box-'+t)&&$('#siac-tag-info-box-'+t).remove(),(!i||1>i.length)&&$('#greyout').hide()}},window.tagInfoBoxClicked=function(e){let t=+$(e).css('z-index'),a=document.getElementsByClassName('siac-tag-info-box');for(var n=0;n<a.length;n++)+$(a[n]).css('z-index')<t&&($(a[n]).remove(),n--)},window.appendToField=function(e,t){$(`.field:eq(${e})`).text().length?$(`.field:eq(${e})`).append('<br/>'+t):$(`.field:eq(${e})`).html(t),pycmd(`blur:${e}:${currentNoteId}:${$(`.field:eq(${e})`).html()}`)},window.getSelectionText=function(){if(siacState.searchOnSelection&&!siacState.isFrozen){var e='';window.getSelection?e=window.getSelection().toString():document.selection&&'Control'!=document.selection.type&&(e=document.selection.createRange().text),0<e.trim().length&&'&nbsp;'!=e&&(showLoading('Selection'),pycmd('siac-r-fld-selected '+siacState.selectedDecks.toString()+' ~ '+e))}},window.searchUserNoteTag=function(t,e){t.ctrlKey||t.metaKey?pycmd('siac-create-note-tag-prefill '+e):pycmd('siac-r-user-note-search-tag '+e)},window.switchLeftRight=function(){let e=byId('leftSide'),t=byId('siac-right-side');'leftSide'===e.parentNode.children[0].id?(e.parentNode.insertBefore(t,e),$(document.body).addClass('siac-left-right-switched'),pycmd('siac-switch-left-right true')):(e.parentNode.insertBefore(e,t),$(document.body).removeClass('siac-left-right-switched'),pycmd('siac-switch-left-right false'))},window.onWindowResize=function(e=!0){let t=byId('topbutsOuter').offsetHeight+3;byId('outerWr').style.marginTop=t+'px',byId('outerWr').style.height=`calc(100vh - ${t}px)`,e&&'undefined'!=typeof pdf.instance&&pdf.instance&&(this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){pdf.instance&&pdfFitToPage()},300))},window.setHighlighting=function(e){let t=$(e).is(':checked')?'on':'off';pycmd('siac-toggle-highlight '+t)},window.setTagSearch=function(e){let t=$(e).is(':checked')?'on':'off';pycmd('tagSearch '+t)},window.tagClick=function(e){if($(e).data('tags')&&$(e).data('tags')==$(e).data('name'))return $('#a-modal').show(),void pycmd('siac-render-tags '+$(e).data('tags'));let t=$(e).data('target')||$(e).data('name');$('.siac-tag-info-box').remove(),$('#greyout').hide(),pycmd('siac-tag-clicked '+t)},window.noteSidebarExpandAll=function(){$('#siac-notes-sidebar .exp').each(function(e,i){let a=$(i);if(a.text().length&&'[+]'===a.text()){a.text('[-]'),a.parent().parent().children('ul').toggle();let e=i.dataset.t;1===_siacSidebar.tab?-1===_siacSidebar.addonTagsExpanded.indexOf(e)&&_siacSidebar.addonTagsExpanded.push(e):2===_siacSidebar.tab&&-1===_siacSidebar.ankiTagsExpanded.indexOf(e)&&_siacSidebar.ankiTagsExpanded.push(e)}})},window.noteSidebarCollapseAll=function(){$('#siac-notes-sidebar .exp').each(function(e,i){let a=$(i);if(a.text().length&&'[-]'===a.text()){a.text('[+]'),a.parent().parent().children('ul').toggle();let e=i.dataset.t;1===_siacSidebar.tab?-1!==_siacSidebar.addonTagsExpanded.indexOf(e)&&_siacSidebar.addonTagsExpanded.splice(_siacSidebar.addonTagsExpanded.indexOf(e),1):2===_siacSidebar.tab&&-1!==_siacSidebar.ankiTagsExpanded.indexOf(e)&&_siacSidebar.ankiTagsExpanded.splice(_siacSidebar.ankiTagsExpanded.indexOf(e),1)}})},window.deleteNote=function(e){byId('siac-del-modal').innerHTML='<center style="margin: 20px 0 20px 0;">Deleting...</center>',setTimeout(function(){pycmd('siac-delete-user-note '+e)},80)},window.synInputKeyup=function(e,t){13==e.keyCode&&t.value&&pycmd('siac-save-synonyms '+t.value)},window.synonymSetKeydown=function(e,t,i){13==e.keyCode&&t.innerHTML.length&&(pycmd('siac-edit-synonyms '+i+' '+t.innerHTML),e.preventDefault(),$(t).blur())},window.searchSynset=function(e){let t=e.parentElement.parentElement.children[0].children[0].innerHTML;t&&pycmd('siac-r-synset-search '+t)},window.updateFieldToExclude=function(e,t,i){$(e).is(':checked')?pycmd('siac-update-field-to-exclude '+t+' '+i+' false'):pycmd('siac-update-field-to-exclude '+t+' '+i+' true')},window.updateFieldToHideInResult=function(e,t,i){$(e).is(':checked')?pycmd('siac-update-field-to-hide-in-results '+t+' '+i+' false'):pycmd('siac-update-field-to-hide-in-results '+t+' '+i+' true')},window.setSearchOnTyping=function(e,t=!0){siacState.searchOnTyping=e,e?($('.field').on('keydown.siac',fieldKeypress),t&&sendContent()):$('.field').off('keydown.siac',fieldKeypress),sendSearchOnTyping()},window.sendSearchOnTyping=function(){pycmd('siac-config-bool searchOnTyping '+siacState.searchOnTyping)},window.sendSearchOnSelection=function(){pycmd('siac-config-bool searchOnSelection '+siacState.searchOnSelection)},window.fieldKeypress=function(e){return 13==e.keyCode||9==e.keyCode||91==e.keyCode||37<=e.keyCode&&40>=e.keyCode||e.ctrlKey||e.altKey||(siacState.timeout&&(clearTimeout(siacState.timeout),siacState.timeout=null),siacState.timeout=setTimeout(function(){sendContent(e)},delayWhileTyping)),!0},window.searchMaskKeypress=function(e){13===e.keyCode&&sendSearchFieldContent()},window.pinCard=function(e,t){$('#cW-'+t).css('padding','3px 4px 5px 5px'),$('#cW-'+t).css('font-size','9px');let i=byId('cW-'+t).getElementsByClassName('rankingLblAddInfo')[0],a=byId('cW-'+t).getElementsByClassName('editedStamp')[0];$('#cW-'+t).html('<span>&#128204;</span>'),byId('cW-'+t).appendChild(i),byId('cW-'+t).appendChild(a),$('#'+t).parents().first().addClass('pinned'),updatePinned()},window.searchCard=function(e){let t=$(e).parent().next().html();showLoading('Note Search'),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+t)},window.searchCardFromFloated=function(e){let t=byId(e).innerHTML;showLoading('Note Search'),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+t)},window.edit=function(e){pycmd('siac-edit-note '+e)},window.updatePinned=function(){let e='siac-pin';$('.pinned').each(function(){e+=' '+$(this).children().first().children().first().attr('id').substring(3)}),$('.noteFloating').each(function(){e+=' '+$(this).attr('id').substring(3)}),pycmd(e)},window.clearSearchResults=function(){let e=document.querySelectorAll('#searchResults .cardWrapper:not(.pinned)');for(var t=0;t<e.length;t++)e[t].remove();try{byId('siac-start-info').remove(),byId('greyout').style.display='none'}catch(t){}$('.siac-tag-info-box,#siac-results-loader-wrapper').remove(),$('.tagLbl').css('z-index','999')},window.setSearchResults=function(e,t,i,a=1,n=1,s=50,d=-1,l=-1,o=!1,r=!1){let c=new Date().getTime();clearSearchResults();var p=byId('searchResults');if(p.style.overflowY='hidden',p.style.paddingRight='24px',p.innerHTML+=e,r||siacState.keepPositionAtRendering||!(0<e.length)?siacState.keepPositionAtRendering&&(siacState.keepPositionAtRendering=!1):p.scrollTop=0,clearTimeout(loadingTimer),i&&lastHadResults&&byId('info-Took')?(byId('info-Took').innerHTML=i.Took,byId('info-Found').innerHTML=i.Found,byId('tagContainer').innerHTML=i.Tags,byId('keywordContainer').innerHTML=i.Keywords):byId('searchInfo').innerHTML=t,lastHadResults=!!i,$searchInfo.hasClass('hidden')||($searchInfo.get(0).style.display='flex'),gridView?$('#searchResults .cardWrapper').css('display','inline-block'):$('#searchResults .cardWrapper').show(),p.style.overflowY='auto',p.style.paddingRight='10px',byId('greyout').style.display='none',displayPagination(a,n,s,0<e.length,d),-1<l&&byId('info-took'))if(o){let e=new Date().getTime()-l;byId('info-Took').innerHTML=`<b>${e}</b> ms &nbsp;<b style='cursor: pointer' onclick='pycmd("siac-last-timing ${new Date().getTime()-c}")'><i class='fa fa-info-circle'></i></b>`}else byId('info-Took').innerHTML=`<b>${new Date().getTime()-l}</b> ms`},window.displayPagination=function(e,t,a,d,l){if(-1!==l){let e='';if(1<l){e+=`<div onclick='pycmd("siac-rerender ${l-2}")' style='display: inline; cursor: pointer;'>Last Results: &nbsp;</div>`;for(var o=0;o<l-1;o++)e+=`<span onclick='pycmd("siac-rerender ${l-o-2}")'>${o+1}</span>`}byId('siac-cache-displ').innerHTML=e}let i='';if(0===t||!d)return byId('siac-pagination-status').innerHTML='',void(byId('siac-pagination-wrapper').innerHTML='');if(1===e&&1==t)i='';else{i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page 1")'>&#171;</div>`,i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${n(e-1,1)}")'>&#8249;</div>`;let d=0,a=0;e+5>t&&(d=e+5-t),0>=e-5&&(a=Math.abs(e-5)+1);for(var o=n(e-5-d,1);o<=e+5+a;o++)o==e?i+=`<div class='siac-pg-icn siac-pg-icn-active' onclick='pycmd("siac-page ${o}")'>${o}</div>`:o<=t&&(i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${o}")'>${o}</div>`);i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${s(e+1,t)}")'>&#8250;</div>`,i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${t}")'>&#187;</div>`}byId('siac-pagination-status').innerHTML=`Showing ${50*(e-1)+1} - ${s(a,50*e)} of ${a}`,byId('siac-pagination-wrapper').innerHTML=i},window.sendClickedInformation=function(e,t){let i=document.elementFromPoint(e,t);return'IMG'==i.tagName?'img '+i.src:('SPAN'==i.tagName||'DIV'==i.tagName||'MARK'==i.tagName)&&'siac-inner-card'==i.parentElement.className?'note '+i.parentElement.id+' '+i.parentElement.innerHTML:'siac-inner-card'==i.className?'note '+i.id+' '+i.innerHTML:void 0},window.toggleTooltip=function(e){$(e).children().first().toggle()},window.toggleFreeze=function(e){siacState.isFrozen=!siacState.isFrozen,$(e).toggleClass('frozen'),pycmd('siac-freeze '+siacState.isFrozen)},window.hideTop=function(){$('#topContainer').hide(),$('#toggleTop').children().first().html('&#10097;'),pycmd('toggleTop off')},window.toggleTop=function(e){$('#topContainer').toggle(),$('#topContainer').is(':hidden')?($(e).children().first().html('&#10097;'),pycmd('toggleTop off')):($(e).children().first().html('&#10096;'),pycmd('toggleTop on'))},window.toggleGrid=function(e){$(e).is(':checked')?(pycmd('toggleGrid on'),gridView=!0):(pycmd('toggleGrid off'),gridView=!1)},window.activateGridView=function(){gridView=!0,window.setTimeout(function(){$('#gridCb').prop('checked',!0)},400)},window.predefSearchFromSidebar=function(e){let t=siacState.selectedDecks.toString();-1===['lowestPerf','highestPerf','highestRet','lowestRet'].indexOf(e)?pycmd('siac-predef-search '+e+' 200 '+t):(showSearchLoader('<i class=\'fa fa-spinner bold mb-10\' style=\'font-size: 24px;\' /><br>Computing ...'),setTimeout(function(){pycmd('siac-predef-search '+e+' 200 '+t)},250))},window.predefSearch=function(){let t=byId('predefSearchSelect'),e=t.options[t.selectedIndex].value,i=byId('predefSearchNumberSel'),a=i.options[i.selectedIndex].value,n=siacState.selectedDecks.toString();-1===['lowestPerf','highestPerf','highestRet','lowestRet'].indexOf(e)?pycmd('siac-predef-search '+e+' '+a+' '+n):(showSearchLoader('<i class=\'fa fa-spinner bold mb-10\' style=\'font-size: 24px;\' /><br>Computing ...'),setTimeout(function(){pycmd('siac-predef-search '+e+' '+a+' '+n)},250))},window.sort=function(){let t=byId('sortSelect'),e=t.options[t.selectedIndex].value;pycmd('siac-p-sort '+e)},window.toggleAddon=function(){500>document.body.offsetHeight||1e3>document.body.offsetWidth?document.body.classList.contains('siac-wm-both')?(document.body.classList.remove('siac-wm-both'),document.body.classList.add('siac-wm-addon')):document.body.classList.contains('siac-wm-addon')?(document.body.classList.remove('siac-wm-addon'),document.body.classList.add('siac-wm-both')):document.body.classList.contains('siac-wm-fields')&&(document.body.classList.remove('siac-wm-fields'),document.body.classList.add('siac-wm-both')):document.body.classList.contains('siac-wm-both')?(document.body.classList.remove('siac-wm-both'),document.body.classList.add('siac-wm-fields')):document.body.classList.contains('siac-wm-addon')?(document.body.classList.remove('siac-wm-addon'),document.body.classList.add('siac-wm-fields')):document.body.classList.contains('siac-wm-fields')&&(document.body.classList.remove('siac-wm-fields'),document.body.classList.add('siac-wm-both'));let e='Both';document.body.classList.contains('siac-wm-addon')?e='Addon':document.body.classList.contains('siac-wm-fields')&&(e='Fields'),pycmd('siac-window-mode '+e)},window.setWindowMode=function(e){if(document.body.classList.remove('siac-wm-fields'),document.body.classList.remove('siac-wm-addon'),document.body.classList.remove('siac-wm-both'),document.body.classList.remove('siac-wm-autohide'),document.body.classList.add('siac-wm-'+e.toLowerCase()),'Autohide'===e){let e=function(){return byId('siac-right-side')?void byId('siac-right-side').addEventListener('mousemove',addonMouseMove,!0):void setTimeout(e,100)};e()}else byId('siac-right-side')&&byId('siac-right-side').removeEventListener('mousemove',addonMouseMove,!0)},window.fieldsMouseEnter=function(e){document.body.classList.contains('siac-wm-autohide')&&!e.target.classList.contains('visible')&&(e.target.classList.add('visible'),displayedNoteId&&pdf.instance&&setTimeout(()=>{a.displayHighlights(),byId('text-layer').style.left=activeCanvas().offsetLeft+'px'},50))},window.addonMouseMove=function(){clearTimeout(window._siac_move_timer),window._siac_move_timer=setTimeout(function(){$('#siac-right-side').is(':hover')&&byId('leftSide').classList.contains('visible')&&(byId('leftSide').classList.remove('visible'),displayedNoteId&&pdf.instance&&setTimeout(()=>{a.displayHighlights(),byId('text-layer').style.left=activeCanvas().offsetLeft+'px'},50))},400)},window.removeNote=function(e){$('#siac-note-wr-'+e).remove(),updatePinned()},window.getOffset=function(e){for(var t=0,i=0;e&&'siac-right-side'!==e.id&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft-e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{top:i,left:t}},window.calBlockMouseEnter=function(e,t){calTimer=setTimeout(function(){$('#cal-row').is(':hover')&&e.ctrlKey&&(displayCalInfo(t),calTimer=null)},100)},window.displayCalInfo=function(e){let t=getOffset(e.children[0]),i=t.left-153,a=byId('siac-second-col-wrapper').clientWidth-t.left-153;0>i?(i-=t.left-153,document.documentElement.style.setProperty('--tleft',t.left+'px')):document.documentElement.style.setProperty('--tleft','50%'),0>a&&(document.documentElement.style.setProperty('--tleft',-a+153+'px'),i+=a),$('#cal-info').css('left',i+'px').css('top',t.top-275+'px'),byId('cal-info').style.display='block',pycmd('siac-cal-info '+$(e.children[0]).data('index'))},window.calMouseLeave=function(){calTimer=setTimeout(function(){$('#cal-row').is(':hover')||$('#cal-info').is(':hover')||(byId('cal-info').style.display='none'),calTimer=null},300)},window.fieldsBtnClicked=function(){if(siacState.isFrozen)return void pycmd('siac-notification Results are frozen.');if(!$fields.text())return void pycmd('siac-notification Fields are empty.');let e='';showLoading('Typing'),$fields.each(function(t,i){e+=i.innerHTML+'\x1F'}),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+e)},window.showModalSubpage=function(e){$('#modalText').hide(),$('#modal-subpage-inner').html(e),byId('modal-subpage').style.display='flex'},window.hideModalSubpage=function(){$('#modal-subpage-inner').html(''),$('#modal-subpage').hide(),$('#modalText').show()},window.showPDFLoader=function(){let e=pageSidebarDisplayed?230:0;byId('siac-reading-modal-center').innerHTML+=`
    <div id='siac-pdf-loader-wrapper'>
        <div class='siac-pdf-loader' style='margin-right: ${e}px'>
            <div style='margin-top: 7px;'> 
                <div style='margin-bottom: 12px;'><i class="fa fa-download" style='font-size: 25px; color: lightgrey;'></i></div>
                <div id='siac-pdf-loader-text'>Loading PDF file...</div>
            </div>
        </div>
    </div>`},window.showSearchLoader=function(e){if(!byId('siac-results-loader-wrapper')){let t=byId('searchResults');t.scrollTop=0,t.style.overflowY='hidden',$(t).append(`
    <div id='siac-results-loader-wrapper' style='position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 5; height: 100%; text-align: center; background: rgba(0,0,0,0.4); display:flex; align-items: center; justify-content: center; border-radius: 5px;'>
        <div class='siac-search-loader' style='display: inline-block; vertical-align: middle;'>
            <b>${e}</b>
        </div>
    </div>`)}},window.toggleSearchbarMode=function(e){'Mode: Browser'===e.innerHTML?(e.innerHTML='Mode: Add-on',pycmd('siac-searchbar-mode Add-on')):(e.innerHTML='Mode: Browser',pycmd('siac-searchbar-mode Browser'))},window.globalKeydown=function(t){displayedNoteId&&122===t.keyCode&&toggleBothBars()},window.toggleNoteSidebar=function(){byId('siac-notes-sidebar')?pycmd('siac-hide-note-sidebar'):pycmd('siac-show-note-sidebar')},window.focusSearchShortcut=function(){null===displayedNoteId&&byId('siac-browser-search-inp')&&byId('siac-browser-search-inp').focus()},window.triggerSearchShortcut=function(){displayedNoteId||sendContent()},window.addFloatingNote=function(e){let t=$('#'+e.toString()).hasClass('siac-user-note')?`pycmd("siac-edit-user-note ${e}")`:`edit(${e})`,i=byId(e).innerHTML;i=i.replace(/<\/?mark>/g,''),$('#cW-'+e).parent().parent().remove();let a=`<div class='floatingBtnBar'>
        <div class="floatingBtnBarItem" onclick='${t}'>Edit</div>&nbsp;&#65372;
        <div class="floatingBtnBarItem" onclick='searchCardFromFloated("nFC-${e}")'>Search</div>&nbsp;&#65372;
        <div class="floatingBtnBarItem" id='rem-${e}' onclick='byId("nF-${e}").outerHTML = ""; updatePinned();'><span>&#10006;&nbsp;&nbsp;</span></div>
    </div>`,n=`<div id="nF-${e}" class='noteFloating'>
            <div id="nFH-${e}" class='noteFloatingHeader' onmousedown='dragElement(this.parentElement, "nFH-${e}")'>&nbsp;${a}</div>
            <div id="nFC-${e}" class='noteFloatingContent'  onmouseup='getSelectionText()' >${i}</div>
                </div>
            `;8<$('.field').length?$('.field').first().after(n):$('.field').last().after(n),dragElement(byId('nF-'+e),`nFH-${e}`),updatePinned()},window.dragElement=function(t,e,i=!1){function a(t){t=t||window.event,t.preventDefault(),o=t.clientX,r=t.clientY,document.onmouseup=s,document.onmousemove=n}function n(i){i=i||window.event,i.preventDefault(),d=o-i.clientX,l=r-i.clientY,o=i.clientX,r=i.clientY,t.style.top=t.offsetTop-l+'px',t.style.left=t.offsetLeft-d+'px'}function s(){document.onmouseup=null,document.onmousemove=null}var d=0,l=0,o=0,r=0;byId(e)?byId(e).onmousedown=a:t.onmousedown=a},window.drawHeatmap=function(e,t){if('undefined'==typeof CalHeatMap||'undefined'==typeof d3)return void setTimeout(()=>{drawHeatmap(e,t)},200);var i=new CalHeatMap;let a={min:'lightskyblue',max:'steelblue',empty:'#e1e1e1'};document.body.classList.contains('nightMode')&&(a={min:'#fed976',max:'#800026',empty:'black'});let n='%B',s=byId('searchResults').offsetWidth;500>s?n='%b':600>s?n='%b':700>s?n='%b':750>s||800>s||900>s,i.init({data:t,legendColors:a,itemName:['page','pages'],itemSelector:e,considerMissingDataAsZero:!0,dataType:'json',start:new Date(new Date().getFullYear(),0),maxDate:new Date,range:12,rowLimit:7,cellSize:11,cellPadding:2,domain:'month',domainLabelFormat:n,subDomain:'day'});let d=document.getElementsByClassName('cal-heatmap-container')[0];d.getBBox().width>s&&(d.style.zoom=s/(d.getBBox().width+120))},window.drawTopics=function(e,t){return'undefined'==typeof $||'undefined'==typeof $.plot?void setTimeout(()=>{drawTopics(e,t)},200):void $.plot('#'+e,t.map((e)=>({label:e[0],data:e[1]})),{series:{pie:{show:!0,label:{show:!0},combine:{threshold:.02,label:'Others (< 2%)'},stroke:{color:document.body.classList.contains('nightMode')?'#ffffff':'black'}}},legend:{show:!1}})}},function(){var e=Math.max,t=Math.min;window.pdfSearchOngoing=!1,window.pdfCurrentSearch={query:null,lastStart:null,lastEnd:null,breakOnNext:null},window.onPDFSearchBtnClicked=function(e){$(e).hasClass('expanded')?$(e).find('input').focus():($(e).find('input').val(''),pdfCurrentSearch={query:null,lastEnd:null,lastStart:null})},window.onPDFSearchInput=function(e,t){13===t.keyCode&&e&&e.trim().length&&(readerNotification('Searching ...'),e.toLowerCase()!==pdfCurrentSearch.query&&(pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null,pdfCurrentSearch.query=e.toLowerCase()),setTimeout(function(){nextPDFSearchResult()},10))},window.getContents=async function(e=1,t=1e4){for(var i,a=[],n=e;n<=pdf.instance.numPages&&n<=e+t;n++)i=pdf.instance.getPage(n),a.push(i.then(function(e){var t=e.pageIndex+1,a='',i=e.getTextContent();return i.then(function(e){for(var s=0;s<e.items.length;s++)a+=' '+e.items[s].str;return{page:t,text:a.toLowerCase()}})}));return Promise.all(a).then(function(e){return e})},window.resetSearch=function(){pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null},window.nextPDFSearchResult=async function(e='right'){if(!pdfSearchOngoing){let i=$('#siac-pdf-search-btn-inner input').first().val().toLowerCase();if(null===pdfCurrentSearch.query?pdfCurrentSearch.query=i:(i!==pdfCurrentSearch.query||pdf.page!==pdfCurrentSearch.lastStart&&pdfCurrentSearch.lastStart===pdfCurrentSearch.lastEnd)&&(pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null,pdfCurrentSearch.query=i),!!pdfCurrentSearch.query){pdfCurrentSearch.breakOnNext=!1,pdfSearchOngoing=!0,greyoutBottom();var t=!1,a=!1,s=pdfCurrentSearch.query.toLowerCase().split(' '),d=0;do{d++;var l=getNextPagesToSearchIn(e);if('left'===e)var o=(await getContents(l.s,l.n)).reverse();else var o=await getContents(l.s,l.n);0===o.length&&(t=!0);for(var r=0;r<o.length&&!t;r++)for(var n=0;n<s.length;n++)if(-1!==o[r].text.indexOf(s[n])){pdf.page===o[r].page?readerNotification('Text found on current page',!0):readerNotification('Text found on page '+o[r].page,!0),pdf.page=o[r].page,queueRenderPage(pdf.page,!0,!1,!1,pdfCurrentSearch.query),pdfCurrentSearch.lastStart=pdf.page,pdfCurrentSearch.lastEnd=pdf.page,t=!0,a=!0;break}if(d>Math.round(pdf.instance.numPages/25)+2){readerNotification('Search aborted, took too long.',!0);break}}while(!t);a||(readerNotification('Text was not found.',!0),ungreyoutBottom()),pdfSearchOngoing=!1}}},window.getNextPagesToSearchIn=function(i){if(pdfCurrentSearch.breakOnNext)return[];let a=pdfCurrentSearch.lastStart,d=pdfCurrentSearch.lastEnd,l=25,o=-1,r=l;return'left'===i?(null===a?(o=e(pdf.page-l,1),r=t(l,pdf.page-o)):1===a?o=e(pdf.instance.numPages-l,1):d===a&&1!==d&&1<pdf.instance.numPages?(o=e(a-l-1,1),r=1===o?e(0,t(l,pdf.page-3)):t(l,pdf.page-o-1)):(o=e(a-l,1),1===o&&(r=e(0,a-2))),null!==a&&a>pdf.page&&o<=pdf.page?(o=pdf.page,pdfCurrentSearch.breakOnNext=!0):1===pdf.instance.numPages&&(r=0,pdfCurrentSearch.breakOnNext=!0)):(null===a?(o=pdf.page,r=t(pdf.instance.numPages-o,l)):d===pdf.instance.numPages?(o=1,r=t(l,pdf.instance.numPages)):(o=d+1,r=t(pdf.instance.numPages-o,l)),null!==d&&d<pdf.page&&o+l>=pdf.page?(r=pdf.page-o,pdfCurrentSearch.breakOnNext=!0):null!==d&&d===pdf.instance.numPages&&1+l>=pdf.page?(r=pdf.page-o,pdfCurrentSearch.breakOnNext=!0):1===pdf.instance.numPages&&(r=0,pdfCurrentSearch.breakOnNext=!0)),1===o&&pdf.instance.numPages<=r&&(pdfCurrentSearch.breakOnNext=!0),pdfCurrentSearch.lastStart=o,pdfCurrentSearch.lastEnd=t(pdf.instance.numPages,o+r),{s:o,n:r}},window.highlightPDFText=function(a,s=0){var n=byId('text-layer').querySelectorAll('span');if(0===n.length)return void(3>s&&setTimeout(function(){highlightPDFText(a,s+1)},200));let d=a.toLowerCase().split(' ');for(var l=0;l<d.length;l++)for(var i=0;i<n.length;i++)if(-1!==n[i].innerHTML.toLowerCase().indexOf(d[l])){var t=new RegExp(escapeRegExp(d[l]),'ig');n[i].innerHTML=n[i].innerHTML.replace(t,'<span class=\'tl-highlight\'>$&</span>')}byId('siac-pdf-top').scrollTop=e(0,$('#text-layer .tl-highlight').first()[0].parentElement.offsetTop-50)}},function(){var e=Math.abs;window.pdfImgSel={canvas:null,context:null,startX:null,endX:null,startY:null,endY:null,cvsOffLeft:null,cvsOffTop:null,mouseIsDown:!1,canvasDispl:null},window.pdfImgMouseUp=function(){if(pdfImgSel.mouseIsDown){pdfImgSel.mouseIsDown=!1,drawSquare();var e=activeCanvas();cropSelection(e,pdfImgSel.startX,pdfImgSel.startY,pdfImgSel.endX-pdfImgSel.startX,pdfImgSel.endY-pdfImgSel.startY,insertImage),$(pdfImgSel.canvas).remove(),$('#text-layer').show()}},window.pageSnapshot=function(){var e=activeCanvas();cropSelection(e,0,0,e.offsetWidth,e.offsetHeight,insertImage)},window.cropSelection=function(e,t,i,a,n,s){if(!(2>a||2>n)){let d=document.createElement('canvas'),l=d.getContext('2d');d.width=a,d.height=n,l.drawImage(e,t*window.devicePixelRatio,i*window.devicePixelRatio,a*window.devicePixelRatio,n*window.devicePixelRatio,0,0,d.width,d.height),s(d.toDataURL())}},window.insertImage=function(e){pycmd('siac-add-image 1 '+e.replace('image/png',''))},window.pdfImgMouseDown=function(e){pdfImgSel.canvasDispl=activeCanvas().offsetLeft,pdfImgSel.mouseIsDown=!0,pdfImgSel.cvsOffLeft=$(pdfImgSel.canvas).offset().left,pdfImgSel.cvsOffTop=$(pdfImgSel.canvas).offset().top,pdfImgSel.startX=pdfImgSel.endX=e.clientX-pdfImgSel.cvsOffLeft,pdfImgSel.startY=pdfImgSel.endY=e.clientY-pdfImgSel.cvsOffTop,drawSquare()},window.initImageSelection=function(){if(pdf.instance){if($('#text-layer').is(':hidden'))return $(pdfImgSel.canvas).remove(),void $('#text-layer').show();disableAreaHighlight(),$('#text-layer').hide(),pdfImgSel.canvas=activeCanvas();var e=document.createElement('canvas');pdfImgSel.canvas.parentNode.insertBefore(e,pdfImgSel.canvas.nextSibling),$(e).css({width:pdfImgSel.canvas.width/window.devicePixelRatio+'px',height:pdfImgSel.canvas.height/window.devicePixelRatio+'px',top:'0',left:document.getElementById('text-layer').style.left,position:'absolute',"z-index":999999,opacity:.3,cursor:'crosshair'}),e.setAttribute('width',pdfImgSel.canvas.width),e.setAttribute('height',pdfImgSel.canvas.height),pdfImgSel.context=e.getContext('2d'),e.addEventListener('mousedown',function(t){pdfImgMouseDown(t)},!1),e.addEventListener('mouseup',function(t){pdfImgMouseUp(t)},!1),e.addEventListener('mousemove',function(t){pdfImgMouseXY(t)},!1),pdfImgSel.canvas=e}},window.pdfImgMouseXY=function(e){pdfImgSel.mouseIsDown&&(pdfImgSel.endX=e.clientX-pdfImgSel.cvsOffLeft,pdfImgSel.endY=e.clientY-pdfImgSel.cvsOffTop,drawSquare())},window.drawSquare=function(){pdfImgSel.context.clearRect(0,0,pdfImgSel.context.canvas.width,pdfImgSel.context.canvas.height),pdfImgSel.context.fillRect(pdfImgSel.startX*window.devicePixelRatio,pdfImgSel.startY*window.devicePixelRatio,e(pdfImgSel.startX-pdfImgSel.endX)*window.devicePixelRatio,e(pdfImgSel.startY-pdfImgSel.endY)*window.devicePixelRatio),pdfImgSel.context.fillStyle='yellow',pdfImgSel.context.fill()},window.clearImgSelectionCanvas=function(){if(pdfImgSel.canvas){let e=pdfImgSel.canvas.getContext('2d');e.clearRect(0,0,e.canvas.width,e.canvas.height)}},window.initAreaHighlight=function(){for(let e=document.getElementsByClassName('area_highlight_cv');e[0];)e[0].parentNode.removeChild(e[0]);pdfImgSel.canvas=activeCanvas();var e=document.createElement('canvas');e.classList.add('area_highlight_cv'),e.oncontextmenu=disableAreaHighlight,pdfImgSel.canvas.parentNode.insertBefore(e,pdfImgSel.canvas.nextSibling),$(e).css({width:pdfImgSel.canvas.width/window.devicePixelRatio+'px',height:pdfImgSel.canvas.height/window.devicePixelRatio+'px',top:'0',left:document.getElementById('text-layer').style.left,position:'absolute',"z-index":999999,opacity:.3,cursor:'crosshair'}),e.setAttribute('width',pdfImgSel.canvas.width),e.setAttribute('height',pdfImgSel.canvas.height),pdfImgSel.context=e.getContext('2d'),e.addEventListener('mousedown',function(t){pdfImgMouseDown(t)},!1),e.addEventListener('mouseup',function(t){pdfAreaHighlightMouseUp(t)},!1),e.addEventListener('mousemove',function(t){pdfImgMouseXY(t)},!1),pdfImgSel.canvas=e},window.disableAreaHighlight=function(){return pdfImgSel.canvas&&($(pdfImgSel.canvas).remove(),pdfImgSel.canvas=null),!1},window.pdfAreaHighlightMouseUp=function(){pdfImgSel.mouseIsDown&&(pdfImgSel.mouseIsDown=!1,drawSquare(),Highlighting.createAreaHighlight(pdfImgSel.startX,pdfImgSel.startY,pdfImgSel.endX-pdfImgSel.startX,pdfImgSel.endY-pdfImgSel.startY),clearImgSelectionCanvas())}},function(){var t=Math.min;window.onPDFCopy=function(i){let e=getSelection(),a=e.getRangeAt(0),n=nodesInSelection(a);if(!n)return;let s='',d=0,l=0,o=0,r=0,c=[],p=null;for(let e=0;e<n.length;e++)(n[e].offsetLeft<d||n[e].offsetTop>l+5)&&!n[e].innerText.startsWith(' ')?(p&&4<Math.abs(+n[e].style.fontSize.substring(0,n[e].style.fontSize.indexOf('px'))-p)?(s+='\n\n'+n[e].innerText,r+=2):0<c.length&&n[e].offsetTop-l>c.slice(-1)[0]+2?(s+='\n\n'+n[e].innerText,r+=2):s.endsWith('-')?(s=s.substring(0,s.length-1)+n[e].innerText,r--):(s+=' '+n[e].innerText,r++),0!==l&&c.push(n[e].offsetTop-l),p=+n[e].style.fontSize.substring(0,n[e].style.fontSize.indexOf('px'))):d+o<n[e].offsetLeft-2&&!n[e].innerText.startsWith(' ')?(s+=' '+n[e].innerText,r++):s+=n[e].innerText,d=n[e].offsetLeft,l=n[e].offsetTop,o=n[e].offsetWidth;let g=e.toString();if(!s.length&&g.length&&(s=g),s=s.replace('  ',' '),!g.startsWith(s.substring(0,t(10,s.length))))for(var f=10;0<f;f--)if(0<s.indexOf(g.substring(0,t(f,g.length)))){s=s.substring(s.indexOf(g.substring(0,t(f,g.length))));break}if(s.length>g.length+r)for(var h=10;0<h;h--){let e=g.substring(g.length-t(g.length,h));if(0<=s.lastIndexOf(e)){s=s.substring(0,s.lastIndexOf(e)+e.length);break}}s=s.replace(/( |&nbsp;){2,}/g,' '),s=s.replace(/ ([,.;:]) /g,'$1 '),s=s.replace(/ ([)\].!?:])/g,'$1'),s=s.replace(/([(\[]) /g,'$1'),i.clipboardData.setData('text/plain',s),i.preventDefault()},window.pdfLeftTabPdfSearchKeyup=function(e,t){13!==t.keyCode||e&&0<e.trim().length&&pycmd('siac-pdf-left-tab-pdf-search '+e)},window.pdfLeftTabAnkiSearchKeyup=function(e,t){13!==t.keyCode||e&&0<e.trim().length&&pycmd('siac-pdf-left-tab-anki-search '+e)},window.initAreaHighlightShortcutPressed=function(){pdf.instance&&!iframeIsDisplayed&&0<Highlighting.colorSelected.id&&(readerNotification('&nbsp;Area Highlight&nbsp;'),initAreaHighlight(),pdfTextLayerMetaKey=!1)},window.pdfTooltipClozeKeyup=function(e){try{if(e.ctrlKey&&e.shiftKey&&67===e.keyCode){let e=window.getSelection().toString();if(!e||0===e.length)return;let i=byId('siac-pdf-tooltip-results-area').innerHTML;for(var t=1;20>t;t++)if(-1===i.indexOf('{{c'+t+'::')){i=i.split(e).join('<span style=\'color: lightblue;\'>{{c'+t+'::'+e+'}}</span>'),byId('siac-pdf-tooltip-results-area').innerHTML=i;break}}}catch(e){pycmd('siac-notification Something went wrong during clozing:<br> '+e.message)}},window.markClicked=function(e){'siac-page-mark-link'===e.target.className&&(pdf.page=+e.target.innerHTML,queueRenderPage(pdf.page,!0))},window.iframeBtnClicked=function(e){e.preventDefault(),$(e.target).toggleClass('expanded'),e.stopPropagation(),$(e.target).hasClass('expanded')&&$(e.target).find('input').first().focus()},window.textlayerClicked=function(t,i){if(!t.ctrlKey&&!windowHasSelection()&&($('#siac-pdf-tooltip').hide(),'none'!==i.style.pointerEvents)){i.style.pointerEvents='none';let a=$.Event('click');a.ctrlKey=!0,$(document.elementFromPoint(t.clientX,t.clientY)).trigger(a),i.style.pointerEvents='auto'}},window.pdfKeyup=function(t){if(!t.ctrlKey&&!t.metaKey&&pdfTooltipEnabled&&windowHasSelection()){$('#text-layer .tl-highlight').remove();let e=window.getSelection(),t=e.getRangeAt(0),i=e.toString();if(0===i.trim().length||500<i.length)return;$('#text-layer > span').css('height','auto');let a=nodesInSelection(t),n=getSentencesAroundSelection(t,a,i);1<a.length&&(i=joinTextLayerNodeTexts(a,i));let s=t.getBoundingClientRect(),d=byId('siac-reading-modal').getBoundingClientRect();byId('siac-pdf-tooltip-results-area').innerHTML='<center>Searching...</center>',byId('siac-pdf-tooltip-searchbar').value='';let l=s.left-d.left;250>d.width-l&&(l-=200);let o=s.top-d.top+s.height;if(0>o)return;$('#siac-pdf-tooltip').css({top:o+'px',left:l+'px'}).show(),pycmd('siac-pdf-selection '+i),$('#siac-pdf-tooltip').data({sentences:n,selection:i,top:o}),$('#text-layer > span').css('height','200px')}else(t.ctrlKey||t.metaKey)&&0<Highlighting.colorSelected.id&&windowHasSelection()?(Highlighting.highlight(),pdfTextLayerMetaKey=!1):(t.ctrlKey||t.metaKey)&&0===Highlighting.colorSelected.id&&!windowHasSelection()&&Highlighting.insertText(t)},window.pdfMouseWheel=function(e){(e.ctrlKey||e.metaKey)&&(0>e.deltaY?pdfScaleChange('up'):0<e.deltaY&&pdfScaleChange('down'),e.preventDefault())}},function(){window.joinTextLayerNodeTexts=function(e,t){let a='';for(var n=0;n<e.length;n++){if(e[n].innerHTML===t)return t;a+=e[n].innerHTML+=' '}a=a.replace('  ',' ');let i=a.split(' ');a='';for(var n=0;n<i.length;n++)0<i[n].length&&0<=t.indexOf(i[n])&&(a+=i[n]+' ');return a.trim()},window.nodesInSelection=function(e){var t=byId('text-layer').children;let a=[],n=!1,s='#text'===e.startContainer.nodeName?e.startContainer.parentNode:e.startContainer,d='#text'===e.endContainer.nodeName?e.endContainer.parentNode:e.endContainer;for(var l=0;l<t.length&&(t[l]==s&&(n=!0),n&&a.push(t[l]),t[l]!=d);l++);return a},window.getSentencesAroundSelection=function(e,t,a){if(!e.startContainer)return;a=a.replace(/  +/g,' ').trim();let n=e.startContainer.parentElement.previousSibling,s='',d=0,l=0;if(1===t.length)s=t[0].innerHTML,d=t[0].clientHeight;else for(var o=0;o<t.length;o++)s+=t[o].innerHTML+' ',d=t[o].clientHeight;l=t[0].offsetTop,s=s.replace(/  +/g,' ').trim();let i=[];for(n||i.push(s);n;){if(5<Math.abs(n.clientHeight-d)||l-n.offsetTop>1.5*d){i.push(s);break}l=n.offsetTop,s=(n.innerHTML+' '+s).replace(/  +/g,' ').trim();let e=extractPrev(s,i,a);if(i=e[1],e[0])break;if(n=n.previousSibling,!n){i.push(s);break}}let r=[];for(var o=0;o<i.length;o++)for(s=i[o],n=e.endContainer.parentElement.nextSibling,n||r.push(s);n;){s=(s+' '+n.innerHTML).replace(/  +/g,' ').trim();let e=extractNext(s,r,a);if(r=e[1],e[0])break;if(n=n.nextSibling,!n){r.push(s);break}}return r},window.sendClozes=function(){let e=$('#siac-pdf-tooltip').data('sentences'),t=$('#siac-pdf-tooltip').data('selection');pycmd('siac-show-cloze-modal '+t+'$$$'+e.join('$$$'))},window.generateClozes=function(){let e='';$('.siac-cl-row').each(function(t,i){e+='$$$'+$(i.children[0].children[0]).text()});let t=$('#siac-pdf-top').data('pdfpath'),i=$('#siac-pdf-top').data('pdftitle');pycmd('siac-generate-clozes $$$'+i+'$$$'+t+'$$$'+pdf.page+e),$('#siac-pdf-tooltip').hide()},window.extractPrev=function(e,t,i){e=e.substring(0,e.lastIndexOf(i)+i.length)+e.substring(e.lastIndexOf(i)+i.length).replace(/\./g,'$DOT$');let a=e.match(/.*[^.\d][.!?]"? (.+)/);if(!a||-1===a[1].indexOf(i))return[!1,t];let n=a[1].replace(/\$DOT\$/g,'.');return-1===t.indexOf(n)&&t.push(n),[!0,t]},window.extractNext=function(e,t,i){e=e.substring(0,e.indexOf(i)).replace(/\./g,'$DOT$')+e.substring(e.indexOf(i));let a=e.match(/(.+?(\.\.\.(?!,| [a-z])|[^.]\.(?!(\.|[0-9]|[A-Z]{2,20}))|[!?]|[^0-9]\. [A-Z])).*/);if(!a||-1===a[1].indexOf(i))return[!1,t];let n=a[1].replace(/\$DOT\$/g,'.');return-1===t.indexOf(n)&&t.push(n),[!0,t]}},function(){var e=Math.max,t=Math.abs;window.setPDFColorMode=function(e){$('#siac-pdf-color-mode-btn > span').first().text(e),pdfColorMode=e,rerenderPDFPage(pdf.page,!1),pycmd('siac-update-config-str pdf.color_mode '+e),$('#siac-pdf-top').removeClass('siac-pdf-sand siac-pdf-night siac-pdf-peach siac-pdf-day siac-pdf-rose siac-pdf-moss siac-pdf-coral siac-pdf-x1 siac-pdf-x2 siac-pdf-mud').addClass('siac-pdf-'+pdfColorMode.toLowerCase())},window.invertCanvas=function(e){'Night'===pdfColorMode?(applyFilter(e,'#121212','overlay'),colorize(e,'#2496dc',.4)):'X1'===pdfColorMode?(invert(e),colorize(e,'teal',.4),darken(e,'lightsalmon')):'X2'===pdfColorMode?(invert(e),colorize(e,'darkslategrey',.4),darken(e,'coral')):'Mud'===pdfColorMode?(invert(e),colorize(e,'coral',.3),darken(e,'coral')):'Coral'===pdfColorMode?darken(e,'#ffb89e'):'Sand'===pdfColorMode?darken(e,'#ffebb3'):'Peach'===pdfColorMode?darken(e,'#ffcba4'):'Moss'===pdfColorMode&&colorize(e,'green',.4),e.canvas.style.display='inline-block'},window.pxToSandScheme=function(i,a,n){return 240<i&&240<a&&240<n?{r:241,g:206,b:147}:15>t(i-a)&&15>t(i-n)?(i=e(0,i-40),a=e(0,a-40),n=e(0,n-40),{r:i,g:a,b:n}):100>i&&100>a&&100>n?{r:0,g:0,b:0}:{r:i,g:a,b:n}},window.pxToPeachScheme=function(i,a,n){return 240<i&&240<a&&240<n?{r:237,g:209,b:176}:15>t(i-a)&&15>t(i-n)?(i=e(0,i-40),a=e(0,a-40),n=e(0,n-40),{r:i,g:a,b:n}):100>i&&100>a&&100>n?{r:0,g:0,b:0}:{r:i,g:a,b:n}},window.colorize=function(e,t,i){e.globalCompositeOperation='source-atop',e.globalAlpha=i,e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation='source-over',e.globalAlpha=1},window.invert=function(e){e.globalCompositeOperation='difference',e.fillStyle='white',e.fillRect(0,0,e.canvas.width,e.canvas.height)},window.darken=function(e,t){e.globalCompositeOperation='darken',e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},window.lighten=function(e,t){e.globalCompositeOperation='lighten',e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},window.overlay=function(e,t){e.globalCompositeOperation='overlay',e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},window.applyFilter=function(e,t,i){e.globalCompositeOperation=i,e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},window.refreshCanvas=function(){try{const e=activeCanvas().getContext('2d');e.putImageData(e.getImageData(0,0,e.canvas.width,e.canvas.height),0,0)}catch(t){}},window.setTextureBg=function(e,t){pycmd('siac-update-config-str styles.readingModalBackgroundSize $1'.replace('$1',t)),pycmd('siac-styling styles.readingModalTexture url(\'$1.svg\')'.replace('$1',e))}},function(){window.tryExtractTextFromTextNote=function(){saveTextNote($('#siac-reading-modal-top-bar').data('nid')),pycmd('siac-try-copy-text-note')},window.saveTextNote=function(e){let t='';try{t=textEditor.value()}catch(t){return void pycmd('siac-notification Could not save text note for some reason.')}readerNotification('&nbsp;<i class=\'fa fa-save\'></i>&nbsp; Note saved.&nbsp;'),pycmd('siac-update-note-text '+e+' '+t)},window.editorMDInit=function(){textEditor=new SimpleMDE({element:byId('siac-text-top').children[0],indentWithTabs:!0,autoDownloadFontAwesome:!1,autosave:{enabled:!1},placeholder:'',status:!1,tagSize:4,toolbar:['bold','italic','heading','code','quote','unordered-list','ordered-list','horizontal-rule','link']})},window.textEditorKeyup=function(){if(pdfTooltipEnabled&&windowHasSelection()){let e=window.getSelection(),t=e.getRangeAt(0),i=e.toString();if(0===i.trim().length||500<i.length)return;let a=nodesInSelection(t),n=getSentencesAroundSelection(t,a,i);1<a.length&&(i=joinTextLayerNodeTexts(a,i));let s=t.getBoundingClientRect(),d=byId('siac-reading-modal').getBoundingClientRect();byId('siac-pdf-tooltip-results-area').innerHTML='<center>Searching...</center>',byId('siac-pdf-tooltip-searchbar').value='';let l=s.left-d.left;250>d.width-l&&(l-=200);let o=s.top-d.top+s.height;if(0>o)return;$('#siac-pdf-tooltip').css({top:o+'px',left:l+'px'}).show(),pycmd('siac-pdf-selection '+i),$('#siac-pdf-tooltip').data({sentences:n,selection:i,top:o})}}},function(){var e=Math.trunc;window.siacYt={player:null},window.initYtPlayer=function(e,t){return'undefined'==typeof YT?void readerNotification('Seems like Youtube API is not loaded. Maybe check your internet connection?'):void(siacYt.player=new YT.Player('siac-yt-player',{height:'360',width:'640',videoId:e,playerVars:{start:t}}))},window.ytCurrentTime=function(){return Math.round(siacYt.player.getCurrentTime())},window.ytScreenCapture=function(){let t=document.getElementById('siac-yt-player');if(t){let i=t.getBoundingClientRect();pycmd(`siac-screen-capture ${e(i.top)} ${e(i.right)} ${e(i.bottom)} ${e(i.left)}`)}},window.ytSavePosition=function(){let t=ytCurrentTime(),i=t%60;0===i&&(i='00'),pycmd('siac-yt-save-time '+t),readerNotification(`Saved Position.<br>Video will resume at ${e(t/60)}:${i}`)}},function(){},function(e,t,i){'use strict';var a=Math.floor;i.r(t);var n=i(2),s=i(3),d=i(4),l=i(5),o=i(0);if(window.Highlighting=o.Highlighting,window.tomato={remainingSeconds:1800,readingTimer:null,lastStart:30},window.pdf={instance:null,displayedViewPort:null,pageRendering:!1,page:null,displayedScale:2,highDPIWasUsed:!1,pageNumPending:null,latestRenderTimestamp:null,TOC:null,pagesRead:[],extract:null,extractExclude:null,displayedMarks:null,displayedMarksTable:null,lastReadPages:{},notification:{queue:[],current:''}},window.noteLoading=!1,window.pdfLoading=!1,window.modalShown=!1,window.pdfTooltipEnabled=!0,window.pdfLinksEnabled=!1,window.iframeIsDisplayed=!1,window.pageSidebarDisplayed=!0,window.pdfFullscreen=!1,window.displayedNoteId=null,window.pdfTextLayerMetaKey=!1,window.bottomBarTabDisplayed='marks',window.textEditor=null,'undefined'==typeof r)var r=window;window.activeCanvas=function(){let e=byId('siac-pdf-canvas');return e?'none'===e.style.display?byId('siac-pdf-canvas_1'):e:null},window.checkTOC=function(){if(!pdf.instance)return;let e=pdf.instance;e.getOutline().then(function(t){if(!t||0===t.length)return Promise.reject();let i=t[0].dest;Array.isArray(i)?e.getPageIndex(i[0]).catch((t)=>(console.log(t),Promise.reject())).then(function(e){console.log(e),null!=e&&(byId('siac-toc-btn').style.display='block')}):e.getDestination(i).then(function(e){if(!e)return null;const t=e[0];return t}).then(e.getPageIndex.bind(e)).then(function(e){null!=e&&(byId('siac-toc-btn').style.display='block')})})},window.loadTOC=function(){if(!pdf.instance)return;let e=pdf.instance;pdf.TOC&&0<pdf.TOC.length||(window.pdf.TOC=[],e.getOutline().then(function(t){if(t){let a=[];for(let n,s=0;s<t.length;s++){n=t[s].dest;const i=t[s].title;if(Array.isArray(n)?a.push(e.getPageIndex(n[0]).catch((t)=>(console.log(t),Promise.resolve())).then(function(e){if(null!=e)return window.pdf.TOC.push({title:i,page:parseInt(e)+1}),Promise.resolve()})):a.push(e.getDestination(n).then(function(e){if(!e)return null;const t=e[0];return t}).then(e.getPageIndex.bind(e)).then(function(e){return window.pdf.TOC.push({title:i,page:parseInt(e)+1}),Promise.resolve()})),t[s].items&&0<t[s].items.length){let i=t[s].items;for(let t=0;t<i.length;t++){let n=i[t].dest,d=i[t].title;Array.isArray(n)?a.push(e.getPageIndex(n[0]).catch((t)=>(console.log(t),Promise.resolve())).then(function(e){if(null!=e)return window.pdf.TOC[s].children||(window.pdf.TOC[s].children=[]),window.pdf.TOC[s].children.push({title:d,page:parseInt(e)+1}),Promise.resolve()})):a.push(e.getDestination(n).then(function(e){if(!e)return null;const t=e[0];return t}).then(e.getPageIndex.bind(e)).then(function(e){return window.pdf.TOC[s].children||(window.pdf.TOC[s].children=[]),window.pdf.TOC[s].children.push({title:d,page:parseInt(e)+1}),Promise.resolve()}))}}}return Promise.all(a)}}).then(function(){let e='<ul>';if(pdf.TOC&&pdf.TOC.length){for(var t=0;t<pdf.TOC.length;t++){if(e+=`<li class='siac-toc-item blue-hover' onclick='pdfGotoPg(${pdf.TOC[t].page})'><div><div>${pdf.TOC[t].page}:</div><div class='siac_toc_title'>${pdf.TOC[t].title||'&lt;Untitled&gt;'}</div></div>`,pdf.TOC[t].children&&0<pdf.TOC[t].children.length){e+=`<ul>`;for(var i=0;i<pdf.TOC[t].children.length;i++){let a=pdf.TOC[t].children[i];e+=`<li class='siac-toc-item blue-hover' onclick='pdfGotoPg(${a.page})'><div><div>${a.page}:</div><div class='siac_toc_title'>${a.title||'&lt;Untitled&gt;'}</div></div></li>`}e+='</ul>'}e+='</li>'}e=`<div style='text-align: center; margin-bottom: 10px; padding-bottom: 7px; border-bottom: 2px dotted grey;'><b style='font-size: 14px;' class='fg_lightgrey'>Table of Contents</b></div>
                    <div style='overflow: auto; color: lightgrey; padding-right: 4px;'>${e}</div>`}byId('siac-toc').innerHTML=e}))},window.tocBtnClicked=function(){noteLoading||pdfLoading||($('#siac-toc').is(':visible')?byId('siac-toc').style.display='none':(byId('siac-toc').style.display='flex',loadTOC()),pdfFitToPage())},window.pdfFitToPage=function(){iframeIsDisplayed||rerenderPDFPage(pdf.page,!1,!0,!1,'',!1)},window.queueRenderPage=function(e,t=!0,i=!1,a=!1,n='',s=!0){pdf.pageRendering?pdf.pageNumPending=e:rerenderPDFPage(e,t,i,a,n,s)},window.setupAnnotations=function(e,t,i,a){var n=$(i).offset(),s=e.getAnnotations().then(function(s){t=t.clone({dontFlip:!0}),a.children().remove();for(var d=.001,l=0;l<s.length;l++){var i=s[l],o=i.rect,r=o[2]-o[0],c=o[3]-o[1],p=r*c;p>d&&(d=p)}for(var l=0;l<s.length;l++){var i=s[l],o=i.rect,r=o[2]-o[0],c=o[3]-o[1],p=r*c,g=p/d;if('Link'===i.subtype&&i.url){var f=$('<a>').attr('href',i.url).get(0),o=i.rect,h=e.view;o=pdfjsLib.Util.normalizeRect([o[0],h[3]-o[1]+h[1],o[2],h[3]-o[3]+h[1]]);var r=o[2]-o[0],c=o[3]-o[1],p=r*c;f.style.left=12+n.left+o[0]+'px',f.style.top=n.top+o[1]+'px',f.style.width=r+'px',f.style.height=c+'px',f.style.position='absolute',f.style.zIndex=12-Math.round(8*g);var u=t.transform,m='matrix('+u.join(',')+')';f.style.transform=m;var b=-o[0]+'px '+-o[1]+'px';f.style.transformOrigin=b,a.append(f)}}});return s},window.refreshPDFPage=function(){rerenderPDFPage(pdf.page,!1,!1,!1,'',!0)},window.rerenderPDFPage=function(e,t=!0,i=!1,a=!1,n='',s=!0){!pdf.instance||iframeIsDisplayed||(byId('siac-pdf-tooltip').style.display='none',pdfLoading=!0,a&&pdfLoaderText('Initializing Reader...'),pdf.instance.getPage(e).then(function(d){pdf.pageRendering=!0;var l=new Date().getTime();pdf.latestRenderTimestamp=l;var r=pdf_canvas_0;if('none'!==r.style.display&&(r=pdf_canvas_1),i){var c=d.getViewport({scale:1});pdf.displayedScale=(r.parentNode.clientWidth-23)/c.width}var c=d.getViewport({scale:pdf.displayedScale});r.height=c.height*window.devicePixelRatio,r.width=c.width*window.devicePixelRatio,(1!==window.devicePixelRatio||pdf.highDPIWasUsed)&&(pdf.highDPIWasUsed=!0,r.style.height=c.height+'px',r.style.width=c.width+'px');var p=r.getContext('2d'),g=d.render({canvasContext:p,viewport:c,transform:1===window.devicePixelRatio?null:[window.devicePixelRatio,0,0,window.devicePixelRatio,0,0]});return null===pdf.pageNumPending?void g.promise.then(function(){return(pdfLinksEnabled&&setupAnnotations(d,c,r,$('.annotationLayer')),byId('siac-pdf-page-lbl').innerHTML=`${pdf.page} / ${pdf.instance.numPages}`,pdf.pageRendering=!1,null!==pdf.pageNumPending)?(rerenderPDFPage(pdf.pageNumPending,t,i,a,n,s),pdf.pageNumPending=null,Promise.reject()):(t&&(r.parentElement.scrollTop=0),'siac-pdf-canvas'===r.id?pdf_canvas_1.style.display='none':pdf_canvas_0.style.display='none',r.style.display='inline-block',o.Highlighting._removeAllHighlights(),s&&updatePdfDisplayedMarks(!0),-1!==['Sand','Peach','Night','X1','X2','Mud','Coral','Moss'].indexOf(pdfColorMode)&&invertCanvas(p),d.getTextContent({normalizeWhitespace:!1,disableCombineTextItems:!1}))}).catch(function(){return Promise.reject()}).then(function(d){return!d||pdf.pageRendering?Promise.reject():pdf.pageNumPending?(rerenderPDFPage(pdf.pageNumPending,t,i,a,n,s),pdf.pageNumPending=null,null):void($('#text-layer').css({height:r.height/window.devicePixelRatio,width:r.width/window.devicePixelRatio+1,left:r.offsetLeft}).html(''),pdfjsLib.renderTextLayer({textContent:d,container:byId('text-layer'),viewport:c,textDivs:[]}),n?highlightPDFText(n):resetSearch(),pdfLoading=!1,(a||n)&&ungreyoutBottom(),a&&$('#siac-pdf-loader-wrapper').remove(),pdf.displayedViewPort=c,s?(o.Highlighting.current=[],pycmd('siac-pdf-page-loaded '+pdf.page)):o.Highlighting.displayHighlights(),!pdf.pageNumPending&&!pdf.pageRendering&&(-1===pdf.pagesRead.indexOf(e)?(byId('siac-pdf-overlay').style.display='none',byId('siac-pdf-read-btn').innerHTML='<i class="fa fa-book"></i><b>&nbsp; Read</b>'):(byId('siac-pdf-overlay').style.display='block',byId('siac-pdf-read-btn').innerHTML='<i class="fa fa-book"></i><b>&nbsp; Unread</b>'),s&&(pdf.extract&&0<pdf.extract.length&&(pdf.extract[0]>pdf.page||pdf.extract[1]<pdf.page)?$('#siac-pdf-top').addClass('extract'):0<pdf.extractExclude.length?pdf.extractExclude.find((e)=>e[0]<=pdf.page&&e[1]>=pdf.page)?$('#siac-pdf-top').addClass('extract'):$('#siac-pdf-top').removeClass('extract'):$('#siac-pdf-top').removeClass('extract')),s&&pageSidebarDisplayed&&pycmd(`siac-linked-to-page ${pdf.page} ${pdf.instance.numPages}`),setLastReadPage()))}):(rerenderPDFPage(pdf.pageNumPending,t,i,a,n,s),pdf.pageNumPending=null,Promise.reject())}).catch(function(e){setTimeout(function(){console.log(e)})}))},window.pdfPageRight=function(){!pdf.instance||iframeIsDisplayed||pdf.page<pdf.instance.numPages&&(pdf.page++,queueRenderPage(pdf.page))},window.pdfPageLeft=function(){!pdf.instance||iframeIsDisplayed||1<pdf.page&&(pdf.page--,queueRenderPage(pdf.page))},window.pdfToggleReadAndPageRight=function(){!pdf.instance||iframeIsDisplayed||(pdf.instance&&-1===pdf.pagesRead.indexOf(pdf.page)&&(!pdf.extract||pdf.extract[0]<=pdf.page&&pdf.extract[1]>=pdf.page)&&(pycmd('siac-pdf-page-read '+$('#siac-pdf-top').data('pdfid')+' '+pdf.page+' '+numPagesExtract()),pdf.pagesRead.length?pdf.pagesRead.push(pdf.page):pdf.pagesRead=[pdf.page],updatePdfProgressBar()),pdfPageRight())},window.togglePageRead=function(e){!pdf.instance||pdf.extract&&(pdf.page<pdf.extract[0]||pdf.page>pdf.extract[1])||(!e&&(e=displayedNoteId),-1===pdf.pagesRead.indexOf(pdf.page)?(byId('siac-pdf-overlay').style.display='block',byId('siac-pdf-read-btn').innerHTML='<i class="fa fa-book" aria-hidden="true"></i><b>&nbsp; Unread</b>',pycmd('siac-pdf-page-read '+e+' '+pdf.page+' '+numPagesExtract()),pdf.pagesRead.length?pdf.pagesRead.push(pdf.page):pdf.pagesRead=[pdf.page]):(byId('siac-pdf-overlay').style.display='none',byId('siac-pdf-read-btn').innerHTML='<i class="fa fa-book" aria-hidden="true"></i><b>&nbsp; Read</b>',pycmd('siac-pdf-page-unread '+e+' '+pdf.page+' '+numPagesExtract()),pdf.pagesRead.splice(pdf.pagesRead.indexOf(pdf.page),1)),updatePdfProgressBar())},window.pdfHidePageReadMark=function(){byId('siac-pdf-overlay').style.display='none',byId('siac-pdf-read-btn').innerHTML='\u2713<b>&nbsp; Read</b>'},window.pdfShowPageReadMark=function(){byId('siac-pdf-overlay').style.display='block',byId('siac-pdf-read-btn').innerHTML='&times;<b> Unread</b>'},window.pdfJumpToPage=function(t,e){if(13!==t.keyCode)return;let i=e.value;i=Math.min(pdf.instance.numPages,i),pdf.page=i,queueRenderPage(pdf.page)},window.pdfScaleChange=function(e){'up'===e?pdf.displayedScale+=.1:(pdf.displayedScale-=.1,pdf.displayedScale=Math.max(.1,pdf.displayedScale)),queueRenderPage(pdf.page,!1,!1,!1,'',!1)},window.setAllPagesRead=function(){if(!pdf.extract)pdf.pagesRead=Array.from(Array(pdf.instance.numPages).keys()).map((e)=>++e);else{pdf.pagesRead=[];for(var e=pdf.extract[0];e<=pdf.extract[1];e++)pdf.pagesRead.push(e)}-1!==pdf.pagesRead.indexOf(pdf.page)&&pdfShowPageReadMark()},window.setLastReadPage=function(){pdf.lastReadPages[displayedNoteId]=pdf.page},window.getLastReadPage=function(){return displayedNoteId&&displayedNoteId in pdf.lastReadPages?pdf.lastReadPages[displayedNoteId]:null},window.updatePdfProgressBar=function(){let e=a(10*pdf.pagesRead.length/numPagesExtract()),t=`<span style='margin-right: 10px; display: inline-block; min-width: 35px; font-weight: bold; color: lightgrey;'>${Math.trunc(100*pdf.pagesRead.length/numPagesExtract())} %</span>`;for(var i=0;10>i;i++)t+=i<e?`<div class='siac-prog-sq-filled'></div>`:`<div class='siac-prog-sq'></div>`;byId('siac-prog-bar-wr').innerHTML=t,'pages'===bottomBarTabDisplayed&&pycmd(`siac-pdf-show-bottom-tab ${displayedNoteId} pages`)},window.numPagesExtract=function(){return pdf.extract?pdf.extract[1]-pdf.extract[0]+1:pdf.instance.numPages},window.markReadUpToCurrent=function(){for(var e=0;e<pdf.page;e++)-1===pdf.pagesRead.indexOf(e+1)&&(!pdf.extract||e+1>=pdf.extract[0]&&e+1<=pdf.extract[1])&&pdf.pagesRead.push(e+1);-1!==pdf.pagesRead.indexOf(pdf.page)&&pdfShowPageReadMark()},window._startTimer=function(){tomato.readingTimer&&clearInterval(tomato.readingTimer),tomato.readingTimer=setInterval(function(){if(tomato.remainingSeconds--,$('.siac-reading-modal-timer-lbl').text(a(tomato.remainingSeconds/60)+' : '+(10>tomato.remainingSeconds%60?'0'+tomato.remainingSeconds%60:tomato.remainingSeconds%60)),0>=tomato.remainingSeconds){clearInterval(tomato.readingTimer),tomato.remainingSeconds=60*tomato.lastStart,$('.siac-timer-play-btn').html('<i class=\'fa fa-play mr-5\'></i>Start').addClass('inactive'),setTimerActive(tomato.lastStart);let e=tomato.remainingSeconds;$('.siac-reading-modal-timer-lbl').text(a(e/60)+' : '+(10>e%60?'0'+e%60:e%60)),pycmd('siac-timer-elapsed'),tomato.readingTimer=null}},999)},window.toggleTimer=function(){$('.siac-timer-play-btn').first().hasClass('inactive')?($('.siac-timer-play-btn').removeClass('inactive'),$('.siac-timer-play-btn').html('<i class=\'fa fa-pause mr-5\'></i>Pause'),_startTimer()):(clearInterval(tomato.readingTimer),tomato.readingTimer=null,$('.siac-timer-play-btn').addClass('inactive'),$('.siac-timer-play-btn').html('<i class=\'fa fa-play mr-5\'></i>Start'))},window.resetTimer=function(e){clearInterval(tomato.readingTimer),tomato.readingTimer=null,$('.siac-timer-btn').removeClass('active');let t=+e.innerHTML;$('.siac-timer-btn.'+t).addClass('active'),tomato.remainingSeconds=60*t,tomato.lastStart=t;let i=tomato.remainingSeconds;$('.siac-reading-modal-timer-lbl').text(a(i/60)+' : '+(10>i%60?'0'+i%60:i%60)),$('.siac-timer-play-btn').addClass('inactive').html('<i class=\'fa fa-play mr-5\'></i>Start')},window.startTimer=function(e){resetTimer($('.siac-timer-btn.'+e).get(0)),$('.siac-timer-play-btn').first().trigger('click')},window.setTimerActive=function(e){$('.siac-timer-btn').removeClass('active'),$('.siac-timer-btn.'+e).addClass('active')},window.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')},window.readerNotification=function(e,t){if(e){if(!t&&''!=pdf.notification.current){if(0<pdf.notification.queue.length){if(e===pdf.notification.queue[pdf.notification.queue.length-1])return;}else if(pdf.notification.current===e)return;return void pdf.notification.queue.push(e)}pdf.notification.current=e,byId('siac-pdf-br-notify').innerHTML=e,byId('siac-pdf-br-notify').style.display='block',window.setTimeout(()=>{pdf.notification.current='',byId('siac-pdf-br-notify')?(byId('siac-pdf-br-notify').style.display='none',pdf.notification.queue.length&&setTimeout(function(){let e=pdf.notification.queue.shift();readerNotification(e,!0)},800)):pdf.notification.queue=[]},3500)}},window.swapReadingModal=function(){let e=byId('siac-reading-modal');'siac-right-side'===e.parentNode.id?byId('leftSide').appendChild(e):byId('siac-right-side').appendChild(e)},window.updatePdfDisplayedMarks=function(e){if(null!=pdf.displayedMarks){if(e){let e='';if($('.siac-mark-btn-inner').removeClass('active'),pdf.page in pdf.displayedMarks)for(var t=0;t<pdf.displayedMarks[pdf.page].length;t++)switch(pdf.displayedMarks[pdf.page][t]){case 1:e+='<div class=\'siac-pdf-mark-lbl\'><i class=\'fa fa-star\'></i>&nbsp; Revisit &nbsp;<b onclick=\'$(".siac-mark-btn-inner-1").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-1').first().addClass('active');break;case 2:e+='<div class=\'siac-pdf-mark-lbl\'><i class=\'fa fa-star\'></i>&nbsp; Hard &nbsp;<b onclick=\'$(".siac-mark-btn-inner-2").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-2').first().addClass('active');break;case 3:e+='<div class=\'siac-pdf-mark-lbl\'><i class=\'fa fa-star\'></i>&nbsp; More Info &nbsp;<b onclick=\'$(".siac-mark-btn-inner-3").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-3').first().addClass('active');break;case 4:e+='<div class=\'siac-pdf-mark-lbl\'><i class=\'fa fa-star\'></i>&nbsp; More Cards &nbsp;<b onclick=\'$(".siac-mark-btn-inner-4").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-4').first().addClass('active');break;case 5:e+='<div class=\'siac-pdf-mark-lbl\'><i class=\'fa fa-star\'></i>&nbsp; Bookmark &nbsp;<b onclick=\'$(".siac-mark-btn-inner-5").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-5').first().addClass('active');}byId('siac-pdf-overlay-top-lbl-wrap')&&(byId('siac-pdf-overlay-top-lbl-wrap').innerHTML=e)}let i=byId('siac-queue-readings-list').offsetWidth,n=byId('siac-queue-actions').offsetWidth,s=byId('siac-reading-modal-bottom-bar').clientWidth-i-n-100;var a='';Object.keys(pdf.displayedMarksTable).forEach(function(e){let t='';'1'===e?t='Revisit':'2'===e?t='Hard':'3'===e?t='More Info':'4'===e?t='More Cards':'5'===e?t='Bookmark':void 0;let n='';for(var s=0;s<pdf.displayedMarksTable[e].length;s++)n+='<span class=\'siac-page-mark-link\'>'+pdf.displayedMarksTable[e][s]+'</span>, ';n=0<n.length?n.substring(0,n.length-2):n,a+=`<tr style='color: grey;'><td><b>${t}</b></td><td>${n}</td></tr>`}),a.length&&(a=`<table style='user-select: none; table-layout: fixed; max-width: ${s}px;'>`+a+'</table>'),byId('siac-marks-display')&&(a.length?byId('siac-marks-display').innerHTML=a:byId('siac-marks-display').innerHTML=`<div style='display: flex; flex-direction: column; justify-content: center; height: 80px; width: 135px; text-align: center; color: grey;'>
                    <div class='siac-caps'><i class="fa fa-star-o"></i>&nbsp; No marks</div>
                </div>`),onMarkBtnClicked(byId('siac-mark-jump-btn'))}},window.doneShortcut=function(){pdfLoading||noteLoading||modalShown||!document.body.classList.contains('siac-reading-modal-displayed')||$('#siac-first-in-queue-btn').trigger('click')},window.laterShortcut=function(){pdfLoading||noteLoading||modalShown||!document.body.classList.contains('siac-reading-modal-displayed')||!byId('siac-later-btn')||$('#siac-later-btn').trigger('click')},window.jumpLastPageShortcut=function(){pdfLoading||noteLoading||modalShown||!pdf.instance||(pdf.page=pdf.instance.numPages,queueRenderPage(pdf.page,!0))},window.jumpFirstPageShortcut=function(){pdfLoading||noteLoading||modalShown||!pdf.instance||(pdf.page=1,queueRenderPage(1,!0))},window.pdfGotoPg=function(e){pdfLoading||noteLoading||modalShown||!pdf.instance||(pdf.page=e,queueRenderPage(e,!0))},window.togglePDFLinks=function(e){e||(e=byId('siac-pdf-links-toggle')),e&&(pdfLinksEnabled=!pdfLinksEnabled,pdfLinksEnabled?($(e).addClass('active'),$('.annotationLayer').show(),readerNotification('PDF Links enabled.',!0)):($(e).removeClass('active'),$('.annotationLayer').hide(),readerNotification('PDF Links disabled.',!0)),refreshPDFPage())},window.togglePDFSelect=function(e){e||(e=byId('siac-pdf-tooltip-toggle')),e&&(pdfTooltipEnabled=!pdfTooltipEnabled,pdfTooltipEnabled?($(e).addClass('active'),readerNotification('Search on select enabled.',!0)):($(e).removeClass('active'),$('#siac-pdf-tooltip').hide(),readerNotification('Search on select disabled.',!0)))},window.onMarkBtnClicked=function(e){$(e).hasClass('expanded')&&(pdf.displayedMarks&&0<Object.keys(pdf.displayedMarks).length?byId('siac-mark-jump-btn-inner').innerHTML='<b onclick=\'event.stopPropagation(); jumpToNextMark();\' style=\'vertical-align: middle;\'>Jump to Next Mark</b>':byId('siac-mark-jump-btn-inner').innerHTML='<b style=\'vertical-align:middle; color: grey;\'>No Marks in PDF</b>')},window.jumpToNextMark=function(){if(pdf.instance){let t=Object.keys(pdf.displayedMarks);for(var e=0;e<t.length;e++)if(+t[e]>pdf.page)return pdf.page=+t[e],void queueRenderPage(pdf.page,!0,!1,!1);pdf.page=+t[0],queueRenderPage(pdf.page,!0,!1,!1)}},window.bringPDFIntoView=function(){document.body.classList.contains('siac-wm-fields')&&pycmd('siac-window-mode Addon')},window.beforeNoteQuickOpen=function(){return!(noteLoading||pdfLoading||modalShown)&&(pdf.instance&&(noteLoading=!0,greyoutBottom(),destroyPDF()),bringPDFIntoView(),!0)},window.centerTooltip=function(){let e=$('#siac-pdf-top').width(),t=$('#siac-pdf-top').height(),i=$('#siac-pdf-tooltip');byId('siac-pdf-tooltip-results-area').style.removeProperty('max-height'),byId('siac-pdf-tooltip').style.removeProperty('max-width'),i.css({top:t/2-i.height()/2,left:e/2-i.width()/2})},window.destroyPDF=function(){pdf.instance&&pdf.instance.destroy(),pdf.instance=null},window.pdfUrlSearch=function(e){if(!e.length)return;let t='';$('#siac-iframe-btn tr').each(function(){$(this.children[1].children[0]).is(':checked')&&(t=$(this.children[1].children[0]).data('url'))}),pycmd('siac-url-srch $$$'+e+'$$$'+t),$('#siac-iframe-btn').removeClass('expanded')},window.showQueueInfobox=function(e,t){pdfLoading||noteLoading||modalShown||(pycmd('siac-queue-info '+t),document.documentElement.style.setProperty('--ttop',e.offsetTop+'px'),pdfLoading||noteLoading||modalShown)},window.leaveQueueItem=function(){window.setTimeout(function(){$('#siac-queue-infobox').is(':hover')||$('#siac-queue-readings-list .siac-link-btn:hover').length||hideQueueInfobox()},400)},window.hideQueueInfobox=function(){byId('siac-queue-infobox')&&(byId('siac-queue-infobox').style.display='none',byId('siac-pdf-bottom-tabs').style.visibility='visible')},window.greyoutBottom=function(){$('#siac-reading-modal-bottom-bar .siac-link-btn,#siac-reading-modal-bottom-bar .fa,.siac-bb-btn,.siac-prio-lbl,.siac-queue-btn,#siac-reading-modal-bottom-bar .blue-hover, .siac-page-mark-link,.siac-sched-icn').addClass('siac-disabled')},window.ungreyoutBottom=function(){$('#siac-reading-modal-bottom-bar .siac-link-btn,#siac-reading-modal-bottom-bar .fa,.siac-bb-btn,.siac-prio-lbl,.siac-queue-btn, #siac-reading-modal-bottom-bar .blue-hover, .siac-page-mark-link,.siac-sched-icn').removeClass('siac-disabled')},window.unhideQueue=function(e){pdfLoading||noteLoading||modalShown||pycmd('siac-unhide-pdf-queue '+e)},window.hideQueue=function(e){pdfLoading||noteLoading||modalShown||pycmd('siac-hide-pdf-queue '+e)},window.toggleBottomBar=function(){byId('siac-reading-modal-bottom-bar').classList.contains('bottom-hidden')?(byId('siac-reading-modal-bottom-bar').classList.remove('bottom-hidden'),pycmd('siac-config-bool notes.queue.hide_bottom_bar false')):(byId('siac-reading-modal-bottom-bar').classList.add('bottom-hidden'),pycmd('siac-config-bool notes.queue.hide_bottom_bar true'))},window.toggleTopBar=function(){byId('siac-reading-modal-top-bar').classList.contains('top-hidden')?(byId('siac-reading-modal-top-bar').classList.remove('top-hidden'),byId('siac-reading-modal-top-btns').classList.remove('top-hidden'),pycmd('siac-config-bool notes.queue.hide_top_bar false')):(byId('siac-reading-modal-top-bar').classList.add('top-hidden'),byId('siac-reading-modal-top-btns').classList.add('top-hidden'),pycmd('siac-config-bool notes.queue.hide_top_bar true'))},window.hideBothBars=function(){byId('siac-reading-modal-top-bar').classList.add('top-hidden'),byId('siac-reading-modal-top-btns').classList.add('top-hidden'),byId('siac-reading-modal-bottom-bar').classList.add('bottom-hidden'),pycmd('siac-config-bool notes.queue.hide_top_bar true'),pycmd('siac-config-bool notes.queue.hide_bottom_bar true')},window.toggleBothBars=function(){byId('siac-reading-modal-bottom-bar').classList.contains('bottom-hidden')?(byId('siac-reading-modal-bottom-bar').classList.remove('bottom-hidden'),byId('siac-reading-modal-top-bar').classList.remove('top-hidden'),byId('siac-reading-modal-top-btns').classList.remove('top-hidden'),pycmd('siac-config-bool notes.queue.hide_bottom_bar false'),pycmd('siac-config-bool notes.queue.hide_top_bar false')):(byId('siac-reading-modal-bottom-bar').classList.add('bottom-hidden'),byId('siac-reading-modal-top-bar').classList.add('top-hidden'),byId('siac-reading-modal-top-btns').classList.add('top-hidden'),pycmd('siac-config-bool notes.queue.hide_bottom_bar true'),pycmd('siac-config-bool notes.queue.hide_top_bar true'))},window.bothBarsAreHidden=function(){return byId('siac-reading-modal-top-bar').classList.contains('top-hidden')&&byId('siac-reading-modal-bottom-bar').classList.contains('bottom-hidden')},window.topBarIsHidden=function(){return byId('siac-reading-modal-top-bar').classList.contains('top-hidden')},window.toggleReadingModalFullscreen=function(){pdfFullscreen=!pdfFullscreen,pdfFullscreen?($(document.body).removeClass('siac-fullscreen-show-fields').addClass('siac-fullscreen-show-right'),pdf.instance&&pdfFitToPage(),hideBothBars()):($(document.body).removeClass('siac-fullscreen-show-fields').removeClass('siac-fullscreen-show-right'),onWindowResize(),pdf.instance&&pdfFitToPage())},window.activateReadingModalFullscreen=function(){pdfFullscreen=!1,toggleReadingModalFullscreen()},window.onReadingModalClose=function(){if(!pdfLoading){if(displayedNoteId=null,$(document.body).removeClass('siac-fullscreen-show-fields').removeClass('siac-fullscreen-show-right').removeClass('siac-reading-modal-displayed'),$('#siac-left-tab-browse,#siac-left-tab-pdfs,#siac-reading-modal-tabs-left').remove(),$('#fields').show(),$('#siac-reading-modal').hide(),byId('resultsArea').style.display='block',byId('bottomContainer').style.display='block',byId('topContainer').style.display='flex',destroyPDF(),siacYt.player)try{siacYt.player.destroy()}catch(t){}byId('siac-reading-modal-center').innerHTML='',onWindowResize(),window.$fields=$('.field'),siacState.searchOnTyping&&setSearchOnTyping(!0,!1),pycmd('siac-on-reading-modal-close')}},window.modalTabsLeftClicked=function(e,t){$('#siac-reading-modal-tabs-left .siac-btn').removeClass('active'),$(t).addClass('active'),pycmd('siac-reading-modal-tabs-left-'+e)},window.setPdfTheme=function(e){document.documentElement.style.setProperty('--c-reading-modal-theme-color',e),pycmd('siac-eval update_config(\'styles.readingModalThemeColor\', \''+e+'\')')},window.schedChange=function(e){byId('siac-sched-prio-val').innerHTML=prioVerbose(e.value)},window.prioVerbose=function(e){return 85<=e?`Very high (<b>${e}</b>)`:70<=e?`High (<b>${e}</b>)`:30<=e?`Medium (<b>${e}</b>)`:15<=e?`Low (<b>${e}</b>)`:1<=e?`Very low (<b>${e}</b>)`:'Remove from Queue (<b>0</b>)'},window.scheduleDialogQuickAction=function(){let e=$('input[name=sched]:checked').data('pycmd');pycmd(`siac-eval index.ui.reading_modal.schedule_note(${e})`)},window.removeDialogOk=function(e){'1'==$('input[name=del]:checked').data('pycmd')?pycmd('siac-remove-from-queue '+e):pycmd('siac-delete-current-user-note '+e),modalShown=!1,$('#siac-rm-greyout').hide(),$('#siac-schedule-dialog').hide()},window.updateSchedule=function(){let e=$('input[name=sched]:checked').data('pycmd');if('4'==e){let e=byId('siac-sched-td-inp').value;if(!e)return void pycmd('siac-notification Value is empty!');pycmd('siac-update-schedule td '+e)}else if('5'==e){let e='';if($('#siac-sched-wd input').each(function(t){$(this).is(':checked')&&(e+=(t+1).toString())}),!e.length)return void pycmd('siac-notification Value is empty!');pycmd('siac-update-schedule wd '+e)}else{let e=byId('siac-sched-id-inp').value;if(!e)return void pycmd('siac-notification Value is empty!');pycmd('siac-update-schedule id '+e)}},window.togglePageSidebar=function(e=!0){pageSidebarDisplayed=!pageSidebarDisplayed,pageSidebarDisplayed?(byId('siac-page-sidebar')&&(byId('siac-page-sidebar').style.display='flex'),$('#siac-reading-modal-center').addClass('siac-page-sidebar'),e&&(pdf.instance?pycmd(`siac-linked-to-page ${pdf.page} ${pdf.instance.numPages}`):pycmd(`siac-linked-to-page -1 -1`))):(byId('siac-page-sidebar')&&$('#siac-page-sidebar').hide(),$('#siac-reading-modal-center').removeClass('siac-page-sidebar')),e&&(pdf.instance&&pdfFitToPage(),pycmd('siac-config-bool pdf.page_sidebar_shown '+pageSidebarDisplayed))},window.updatePageSidebarIfShown=function(){pdf.instance&&pageSidebarDisplayed?pycmd(`siac-linked-to-page ${pdf.page} ${pdf.instance.numPages}`):pycmd(`siac-linked-to-page -1 -1`)},window.modalBgUpdate=function(){$('.siac-link-btn').addClass('siac-disabled'),setTimeout(function(){$('.siac-link-btn').removeClass('siac-disabled')},1400)},window.windowHasSelection=function(){return window.getSelection().toString().length},window.pdfLoaderText=function(e){try{byId('siac-pdf-loader-text').innerHTML=e}catch(t){}},window.registerButtonWidthObserver=function(){'ResizeObserver'in self&&(window.siac_ro=new ResizeObserver(function(e){let t=e[0],i=document.getElementsByClassName('siac-reading-modal-button-bar-wrapper');i&&0!==i.length&&($('#siac-page-sidebar').is(':visible')?i[0].classList.add('sidebar'):i[0].classList.remove('sidebar'),560>=t.contentRect.width?(i[0].classList.add('smaller'),i[0].classList.add('small')):690>=t.contentRect.width?(i[0].classList.remove('smaller'),i[0].classList.add('small')):(i[0].classList.remove('small'),i[0].classList.remove('smaller')))}),siac_ro.observe(byId('siac-pdf-overflow')))};var c=i(6),p=i(7),g=i(8),f=i(9),h=i(10)}]));